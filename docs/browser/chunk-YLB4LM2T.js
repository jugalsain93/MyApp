import{h as a,n as c,r as u}from"./chunk-UTQS25EZ.js";import{Ia as d,K as h,N as r,R as o,S as s,Z as v,da as g,l as p,qb as f}from"./chunk-LAEVRNZJ.js";var l=class e{inactivityTimeout;absoluteTimeout;INACTIVITY_LIMIT=10*60*1e3;SESSION_LIMIT=30*60*1e3;router=s(c);ngZone=s(d);injector=s(v);startTracking(){if(!this.injector.get(n).isLoggedIn()){console.log("Session tracking not started: user is not logged in.");return}this.resetInactivityTimer(),this.setAbsoluteTimer(),["click","mousemove","keydown","scroll","touchstart"].forEach(i=>window.addEventListener(i,this.resetInactivityTimer.bind(this)))}resetInactivityTimer(){clearTimeout(this.inactivityTimeout),this.ngZone.runOutsideAngular(()=>{this.inactivityTimeout=setTimeout(()=>{this.logout("Session expired due to inactivity")},this.INACTIVITY_LIMIT)})}setAbsoluteTimer(){clearTimeout(this.absoluteTimeout),this.ngZone.runOutsideAngular(()=>{this.absoluteTimeout=setTimeout(()=>{this.logout("Session expired (30 min limit)")},this.SESSION_LIMIT)})}stopTracking(){clearTimeout(this.inactivityTimeout),clearTimeout(this.absoluteTimeout),["click","mousemove","keydown","scroll","touchstart"].forEach(t=>window.removeEventListener(t,this.resetInactivityTimer.bind(this)))}logout(t){console.warn(t),alert(t);let i=this.injector.get(n);i.isLoggedIn()&&i.logout()}static \u0275fac=function(i){return new(i||e)};static \u0275prov=r({token:e,factory:e.\u0275fac,providedIn:"root"})};var y=u.apiBaseUrl,m=class e{constructor(t){this.http=t}mainMenusCache=null;childMenusCache=null;getMainMenuList(){return this.mainMenusCache!==null?p(this.mainMenusCache):this.http.get(`${y}/Secure/SideMenu/MainMenuList`).pipe(h(t=>this.mainMenusCache=t))}getChildMenuList(){return this.childMenusCache!==null?p(this.childMenusCache):this.http.get(`${y}/Secure/SideMenu/ChildMenuList`).pipe(h(t=>this.childMenusCache=t))}clearMenuCache(){this.mainMenusCache=null,this.childMenusCache=null}static \u0275fac=function(i){return new(i||e)(o(a))};static \u0275prov=r({token:e,factory:e.\u0275fac,providedIn:"root"})};var T=u.apiBaseUrl,n=class e{constructor(t,i,C,k){this.http=t;this.router=i;this.sessionService=C;this.menuService=k}tokenKey="jwtToken";loggedIn=g(!!localStorage.getItem(this.tokenKey));isAuthenticated=f(()=>this.loggedIn());isLoggedIn(){return!!this.getToken()}tempToken="";login(t){return this.http.post(`${T}/Login/Web/Login`,t)}verifyPin(t){return this.http.post(`${T}/Login/Web/LoginVerify`,t)}setJwtToken(t){localStorage.setItem(this.tokenKey,t),this.loggedIn.set(!0)}getToken(){return localStorage.getItem(this.tokenKey)}logout(){debugger;localStorage.removeItem(this.tokenKey),this.sessionService.stopTracking(),this.menuService.clearMenuCache(),this.router.navigate(["/login"]),this.loggedIn.set(!1)}static \u0275fac=function(i){return new(i||e)(o(a),o(c),o(l),o(m))};static \u0275prov=r({token:e,factory:e.\u0275fac,providedIn:"root"})};export{m as a,n as b,l as c};

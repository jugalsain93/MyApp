import{a as I}from"./chunk-OFYSUAYR.js";import{a as P,b as d,c as E,d as T,g as M,i as O,j as R,n as k,o as q,p as A}from"./chunk-IVHO64GE.js";import{b as L}from"./chunk-YLB4LM2T.js";import{d as S,f as C,l as F,n as w}from"./chunk-UTQS25EZ.js";import{Aa as b,Fa as u,Pa as a,Qa as o,Ra as s,Sa as f,Wa as x,Xa as c,a as v,b as h,bb as m,ra as l,tb as y,wa as g,xb as N}from"./chunk-LAEVRNZJ.js";function U(t,i){t&1&&(o(0,"h2"),m(1,"Login"),s())}function j(t,i){t&1&&(o(0,"h2"),m(1,"Enter PIN"),s())}function D(t,i){t&1&&(o(0,"small"),m(1,"Username is required"),s())}function V(t,i){if(t&1&&(o(0,"div"),u(1,D,2,0,"small",2),s()),t&2){let e,n=c(2);l(),a("ngIf",(e=n.loginForm.get("loginName"))==null||e.errors==null?null:e.errors.required)}}function G(t,i){t&1&&(o(0,"small"),m(1,"Password is required"),s())}function z(t,i){t&1&&(o(0,"small"),m(1,"Minimum 8 characters required"),s())}function B(t,i){if(t&1&&(o(0,"div"),u(1,G,2,0,"small",2)(2,z,2,0,"small",2),s()),t&2){let e,n,r=c(2);l(),a("ngIf",(e=r.loginForm.get("password"))==null||e.errors==null?null:e.errors.required),l(),a("ngIf",(n=r.loginForm.get("password"))==null||n.errors==null?null:n.errors.minlength)}}function H(t,i){t&1&&(o(0,"span"),m(1,"Login"),s())}function J(t,i){t&1&&(o(0,"span"),m(1,"Logging in..."),s())}function K(t,i){if(t&1&&(o(0,"div"),f(1,"input",4),u(2,V,2,1,"div",2),f(3,"input",5),u(4,B,3,2,"div",2),o(5,"button",6),u(6,H,2,0,"span",2)(7,J,2,0,"span",2),s()()),t&2){let e,n,r,p=c();l(2),a("ngIf",((e=p.loginForm.get("loginName"))==null?null:e.invalid)&&((e=p.loginForm.get("loginName"))==null?null:e.touched)),l(2),a("ngIf",((n=p.loginForm.get("password"))==null?null:n.invalid)&&((n=p.loginForm.get("password"))==null?null:n.touched)),l(),a("disabled",p.submitting||((r=p.loginForm.get("loginName"))==null?null:r.invalid)||((r=p.loginForm.get("password"))==null?null:r.invalid)),l(),a("ngIf",!p.submitting),l(),a("ngIf",p.submitting)}}function Q(t,i){t&1&&(o(0,"small"),m(1,"PIN is required"),s())}function W(t,i){t&1&&(o(0,"small"),m(1," PIN must be 6 digits "),s())}function X(t,i){if(t&1&&(o(0,"div"),u(1,Q,2,0,"small",2)(2,W,2,0,"small",2),s()),t&2){let e,n,r=c(2);l(),a("ngIf",(e=r.loginForm.get("pin"))==null||e.errors==null?null:e.errors.required),l(),a("ngIf",((n=r.loginForm.get("pin"))==null||n.errors==null?null:n.errors.minlength)||((n=r.loginForm.get("pin"))==null||n.errors==null?null:n.errors.maxlength))}}function Y(t,i){t&1&&(o(0,"span"),m(1,"Verify PIN"),s())}function Z(t,i){t&1&&(o(0,"span"),m(1,"Verifying..."),s())}function $(t,i){if(t&1&&(o(0,"div"),f(1,"input",7),u(2,X,3,2,"div",2),o(3,"button",6),u(4,Y,2,0,"span",2)(5,Z,2,0,"span",2),s()()),t&2){let e,n,r=c();l(2),a("ngIf",((e=r.loginForm.get("pin"))==null?null:e.invalid)&&((e=r.loginForm.get("pin"))==null?null:e.touched)),l(),a("disabled",r.submitting||((n=r.loginForm.get("pin"))==null?null:n.invalid)),l(),a("ngIf",!r.submitting),l(),a("ngIf",r.submitting)}}var _=class t{constructor(i,e,n,r,p,ee,te){this.fb=i;this.authService=e;this.router=n;this.route=r;this.notify=p;this.cdr=ee;this.loadingService=te}loginForm;step=1;submitting=!1;ngOnInit(){if(this.loginForm=this.fb.group({loginName:this.fb.control("",{nonNullable:!0,validators:[d.required]}),password:this.fb.control("",{nonNullable:!0,validators:[d.required,d.minLength(8)]}),pin:this.fb.control("",{nonNullable:!0,validators:[d.required,d.minLength(6),d.maxLength(6)]}),deviceId:this.fb.control("",{nonNullable:!0}),token:this.fb.control("",{nonNullable:!0}),dob:this.fb.control("",{nonNullable:!0}),zipCode:this.fb.control("",{nonNullable:!0})}),this.authService.isAuthenticated()){let i=this.route.snapshot.queryParams.returnUrl||"/dashboard";this.router.navigate([i])}}get f(){return this.loginForm.controls}onSubmit(){if(!this.submitting){if(this.step===1){if(this.f.loginName.invalid||this.f.password.invalid){this.notify.show("Please enter login name and password","warning");return}this.submitting=!0,this.login()}if(this.step===2){if(this.f.pin.invalid){this.notify.show("Please enter PIN","warning");return}this.submitting=!0,this.submitPin()}}}login(){let i=this.loginForm.getRawValue();this.authService.login(i).subscribe({next:e=>{if(e.statusCode===200&&e.entity){debugger;this.authService.tempToken=e.entity,this.notify.show(e.message,"success"),Promise.resolve().then(()=>{this.step=2,this.cdr.detectChanges()})}else this.notify.show(e.message,"warning");this.submitting=!1},error:e=>{debugger;this.submitting=!1,this.cdr.detectChanges(),this.notify.show(this.extractErrorMessage(e),"error")}})}submitPin(){let i=h(v({},this.loginForm.getRawValue()),{token:this.authService.tempToken});this.authService.verifyPin(i).subscribe({next:e=>{if(e.statusCode===200&&e.entity){this.authService.setJwtToken(e.entity);let n=this.route.snapshot.queryParams.returnUrl||"/dashboard";this.router.navigate([n]),this.loadingService.setFullPageLoading(!0)}else this.notify.show(e.message,"warning");this.submitting=!1},error:e=>{this.notify.show(this.extractErrorMessage(e),"error"),this.submitting=!1}})}extractErrorMessage(i){return i.status===0?"Network error: Server unreachable":i.status>=500?"Server error: Please try again later":i.error?.message?i.error.message:typeof i=="string"?i:"Something went wrong"}static \u0275fac=function(e){return new(e||t)(g(k),g(L),g(w),g(F),g(I),g(y),g(N))};static \u0275cmp=b({type:t,selectors:[["app-login"]],decls:7,vars:5,consts:[[1,"login-container"],[1,"login-box"],[4,"ngIf"],["autocomplete","off",3,"ngSubmit","formGroup"],["type","text","formControlName","loginName","placeholder","Username","autocomplete","new-username"],["type","password","formControlName","password","placeholder","Password","autocomplete","new-password"],["type","submit",3,"disabled"],["type","text","formControlName","pin","placeholder","Enter 6-digit PIN","autocomplete","off"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1),u(2,U,2,0,"h2",2)(3,j,2,0,"h2",2),o(4,"form",3),x("ngSubmit",function(){return n.onSubmit()}),u(5,K,8,5,"div",2)(6,$,6,4,"div",2),s()()()),e&2&&(l(2),a("ngIf",n.step===1),l(),a("ngIf",n.step===2),l(),a("formGroup",n.loginForm),l(),a("ngIf",n.step===1),l(),a("ngIf",n.step===2))},dependencies:[C,S,q,M,P,E,T,A,O,R],styles:[".login-container[_ngcontent-%COMP%]{height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#f0f2f5,#dfe3ee);font-family:Segoe UI,sans-serif}.login-box[_ngcontent-%COMP%]{background-color:#fff;padding:40px 30px;border-radius:12px;box-shadow:0 4px 20px #0000001a;width:100%;max-width:360px;transition:all .3s ease}.login-box[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:24px;font-size:24px;color:#333;text-align:center}.login-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 15px;margin-bottom:18px;border:1px solid #ccc;border-radius:8px;font-size:16px;transition:border .3s ease}.login-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:12px;background-color:#007bff;border:none;border-radius:8px;color:#fff;font-size:16px;cursor:pointer;transition:background-color .3s ease}.login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};var be=[{path:"",component:_}];export{be as AUTH_ROUTES};
